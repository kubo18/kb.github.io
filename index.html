<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <script src="js/jquery-1.11.0.min.js"></script>
    <script src="js/clipboard.min.js"></script>
    <link rel="Shortcut Icon" href="images/icon.png">
    <title>酷播</title>
    <link rel="stylesheet" href="css/app.css">
</head>

<body style="width: 412px; height: 732px; overflow: hidden;">
    <div style="display:none;">
        <img src="images/icon.png">
    </div>
    <div id="warp">
        <div class="xiazai">
            <div class="xiazai_ios" style="display:none">
                <!--
                    <a href="itms-services://?action=download-manifest&amp;url=https://suqian360.pw/web/ipa/manifest7_14.plist" class="ppt_dw" data-clipboard-action="copy" data-clipboard-text="&amp;8#@4605">
                        <span >IOS下载</span>
                    </a>
                -->

                <!--
                    <a href="javascript:;" onclick="toUrl('','因不可控因素，商店版本已下架，市面上均为假冒，我们将尽快上架新APP，请耐心等待。')" class="ppt_dw">
                        <span>IOS下载</span>
                    </a>  
                -->
                <!--
                    <a id="copyButton" data-copy-text="1688"
                        href="https://apps.apple.com/cn/app/coolplayer-%E9%85%B7%E6%92%AD-%E8%A7%86%E9%A2%91%E6%92%AD%E6%94%BE%E5%99%A8/id6630381534"
                        class="ppt_dw">
                        <span>IOS下载</span>
                    </a>
                -->
                <a id="copyButton" data-copy-text="1688" href="#" onclick="checkAppInstallation()" class="ppt_dw">
                    <span>打开应用</span>
                </a>
                <!--
             <a href="itms-services://?action=download-manifest&amp;url=https://oss.vanszp.com/ipa/manifest7_14.plist" class="ppt_dw" data-clipboard-action="copy" data-clipboard-text="&amp;8#@4605"></a>
             
             <a href="https://www.pgyer.com/shoushou"  style="width: 330px; height: 132px;"></a>
             -->
            </div>
            <div class="xiazai_ios" style="display:none">
                <p data-v-0ea098a2="" class="update-time">V1.0.0 2024-09-17 更新</p>
            </div>


            <div id="copyButton" data-copy-text="1688" class="xiazai_az" style="display:none">
                <a href="/apk/release/kb.apk"><span>Android下载</span></a>
            </div>
            <div class="xiazai_az" style="display:none">
                <p data-v-0ea098a2="" class="update-time">V1.0.0 2024-05-05 更新</p>
            </div>

        </div>
    </div>
    <div class="wtips" style="display:none">
        <img src="images/tips_weixin_ios.png">
    </div>
    <script>
        $(document).ready(function () {
            $('body').css({ "width": $(window).width(), "height": $(window).height(), "overflow": "hidden" });
            $('.wz>p').css("font-size", $(window).width() * 0.86 * 0.66 * 0.1);
            if ($(window).width() > $(window).height()) {
                //$('.xiazai').css("padding-top", $(window).height() * 0.25);
            }
            else {
                //$('.xiazai').css("padding-top", $(window).height() * 0.25);
            }
            //$('.xiazai_az a,.xiazai_ios a').css({"width": $('.xiazai').width(), "height": $('.xiazai').width() * 0.5});

            var urlParams = new UrlParameters();
            if (typeof urlParams != "undefined" && typeof urlParams.TableKey != "undefined" && urlParams.TableKey != 0) {
                //window.location.href = 'agt-nzg://?TableKey=' + urlParams.TableKey;
                //window.location.href = 'gahhmajiang://TableKey=888888';
            }

            var clipboard = new ClipboardJS('#copyButton', {
                text: function () {
                    return document.getElementById('copyButton').getAttribute('data-copy-text');
                }
            });

            clipboard.on('success', function () {
                console.log('文本已成功复制到剪切板。');
            });

            clipboard.on('error', function (e) {
                console.log('复制失败:', e);
            });


            var t = getUrlParameter('t');
            /*
            if (copyText) {
                console.log('复制:', copyText);
                $('#copyButton').attr('data-copy-text', copyText);
            }*/
            if (t) {
                $.ajax({
                    url: 'https://qiniu.youlun.online/Hh/getCommandData', // 替换为你的服务器端点
                    method: 'POST',
                    data: { command: t, type: 2 },
                    success: function (response) {
                        console.log(response);
                        if (response.code == 1000) {
                            // 假设服务器返回的响应包含复制文本
                            var copyText = response.data.command;
                            console.log(copyText);
                            // 设置到剪切板按钮的 data-copy-text 属性
                            $('#copyButton').attr('data-copy-text', copyText);
                            // 自动触发点击事件
                            //$('#copyButton').click(); //无法复制内容，安装与没安装判断也不对
                        }
                    },
                    error: function (xhr, status, error) {
                        console.error('获取数据失败:', error);
                    }
                });
            }


            function getUrlParameter(name) {
                name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
                var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
                var results = regex.exec(location.search);
                return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
            }


            function UrlParameters() {
                var urlIndex = window.location.href.indexOf("?");
                if (urlIndex) {
                    var parameters = window.location.href.substring(urlIndex + 1);
                    if (parameters) {
                        var arrayParam = parameters.split("&");  //参数数组
                        var index;
                        var name;
                        var value;
                        for (var i = 0; i < arrayParam.length; i++) {
                            index = arrayParam[i].indexOf("=");
                            name = arrayParam[i].substring(0, index);
                            value = arrayParam[i].substring(index + 1);
                            this[name] = value;
                        }
                    }
                }
            }

            function toUrl(url, msg = '') {
                if (msg) {
                    alert(msg);
                }
                return window.location = url;
            }
            /*
             * 智能机浏览器版本信息:
             */
            var browser = {
                versions: function () {
                    var u = navigator.userAgent, app = navigator.appVersion;
                    return {
                        trident: u.indexOf('Trident') > -1, //IE内核
                        presto: u.indexOf('Presto') > -1, //opera内核
                        webKit: u.indexOf('AppleWebKit') > -1, //苹果、谷歌内核
                        gecko: u.indexOf('Gecko') > -1 && u.indexOf('KHTML') == -1, //火狐内核
                        mobile: !!u.match(/AppleWebKit.*Mobile.*/) || !!u.match(/AppleWebKit/), //是否为移动终端
                        ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), //ios终端
                        android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, //android终端或者uc浏览器
                        iPhone: u.indexOf('iPhone') > -1 || u.indexOf('Mac') > -1, //是否为iPhone或者QQHD浏览器
                        iPad: u.indexOf('iPad') > -1, //是否iPad
                        weixin: u.match(/MicroMessenger/i), //微信浏览器
                        webApp: u.indexOf('Safari') == -1 //是否web应该程序，没有头部与底部
                    };
                }(),
                language: (navigator.browserLanguage || navigator.language).toLowerCase()
            };

            if (browser.versions.weixin) {
                if (browser.versions.ios || browser.versions.iphone || browser.versions.ipad) {
                    $('.wtips img').attr("src", "images/tips_weixin_ios.png");
                    $('.wtips').show();
                }
                else {
                    $('.wtips img').attr("src", "images/tips_weixin_android.png");
                    $('.wtips').show();
                }
            }
            if (browser.versions.android) {
                $('.xiazai_az').show();
            }
            else if (browser.versions.ios || browser.versions.iphone || browser.versions.ipad) {
                $('.xiazai_ios').show();
            }
            else {
                $('.xiazai_az').show();
            }
        });
    </script>

    <script>
        function checkAppInstallation() {
            var urlScheme = 'um.66d7d952cac2a664dea1fb19'; // 你的 URL Scheme
            var appStoreUrl = 'https://apps.apple.com/cn/app/coolplayer-%E9%85%B7%E6%92%AD-%E8%A7%86%E9%A2%91%E6%92%AD%E6%94%BE%E5%99%A8/id6630381534'; // App Store 链接
            var timeout = 500; // 延迟时间（毫秒）

            // 创建一个不可见的 iframe
            var iframe = document.createElement('iframe');
            iframe.style.display = 'none';
            iframe.src = urlScheme + '://';
            document.body.appendChild(iframe);

            // 使用 setTimeout 等待应用启动或者确认是否安装
            setTimeout(function () {
                // 移除 iframe
                document.body.removeChild(iframe);
                // 引导用户到 App Store
                window.location.href = appStoreUrl;
                // 打印结果
                //document.getElementById('status').textContent = '应用未安装，正在引导您下载应用...';
                //console.log('应用未安装，用户将被引导到 App Store。');
            }, timeout); // 根据需要调整延迟时间
        }
    </script>
</body>
</body>

</html>
